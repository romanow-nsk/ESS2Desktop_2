/*
 * Click nbfs://nbhost/SystemFileSystem/Templates/Licenses/license-default.txt to change this license
 * Click nbfs://nbhost/SystemFileSystem/Templates/GUIForms/JFrame.java to edit this template
 */
package romanow.abc.desktop;

import romanow.abc.core.entity.metadata.Meta2GUIForm;
import romanow.abc.core.entity.metadata.view.Meta2GUI;
import romanow.abc.desktop.view2.FormContext2;

/**
 *
 * @author Admin
 */
public class ESSGUIEditPanel extends javax.swing.JFrame {

    /**
     * Creates new form ESSGUIEditPanel
     */
    private I_Button back;
    private FormContext2 context;
    private ESSServiceGUIPanel panel;
    public ESSGUIEditPanel(ESSServiceGUIPanel panel0, FormContext2 context2, I_Button onClose) {
        initComponents();
        panel = panel0;
        back = onClose;
        context = context2;
        setBounds(100,100, 300,150);
        setVisible(true);
        Meta2GUI view = context.getSelectedView();
        CopyElem.setEnabled(view!=null);
        RemoveElem.setEnabled(view!=null);
        if (view!=null)
            CopyTitle.setText(view.getTitle());
        if (!context.isRuntimeEditMode()){        // Элемент выбран и редактирование "на лету"
            dispose();
            }
        }

    /**
     * This method is called from within the constructor to initialize the form.
     * WARNING: Do NOT modify this code. The content of this method is always
     * regenerated by the Form Editor.
     */
    @SuppressWarnings("unchecked")
    // <editor-fold defaultstate="collapsed" desc="Generated Code">//GEN-BEGIN:initComponents
    private void initComponents() {

        MoveElems = new javax.swing.JButton();
        DY = new javax.swing.JTextField();
        jLabel1 = new javax.swing.JLabel();
        DX = new javax.swing.JTextField();
        jLabel2 = new javax.swing.JLabel();
        CopyElem = new javax.swing.JButton();
        CopyTitle = new javax.swing.JTextField();
        RemoveElem = new javax.swing.JButton();

        setDefaultCloseOperation(javax.swing.WindowConstants.DISPOSE_ON_CLOSE);
        addWindowListener(new java.awt.event.WindowAdapter() {
            public void windowClosed(java.awt.event.WindowEvent evt) {
                formWindowClosed(evt);
            }
        });
        getContentPane().setLayout(null);

        MoveElems.setIcon(new javax.swing.ImageIcon(getClass().getResource("/drawable/move.png"))); // NOI18N
        MoveElems.setBorderPainted(false);
        MoveElems.setContentAreaFilled(false);
        MoveElems.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                MoveElemsActionPerformed(evt);
            }
        });
        getContentPane().add(MoveElems);
        MoveElems.setBounds(10, 20, 40, 38);

        DY.setText("0");
        getContentPane().add(DY);
        DY.setBounds(50, 40, 40, 25);

        jLabel1.setText("DY");
        getContentPane().add(jLabel1);
        jLabel1.setBounds(100, 40, 37, 16);

        DX.setText("0");
        getContentPane().add(DX);
        DX.setBounds(50, 10, 40, 25);

        jLabel2.setText("DX");
        getContentPane().add(jLabel2);
        jLabel2.setBounds(100, 10, 37, 16);

        CopyElem.setIcon(new javax.swing.ImageIcon(getClass().getResource("/drawable/add.png"))); // NOI18N
        CopyElem.setBorderPainted(false);
        CopyElem.setContentAreaFilled(false);
        CopyElem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                CopyElemActionPerformed(evt);
            }
        });
        getContentPane().add(CopyElem);
        CopyElem.setBounds(140, 40, 30, 30);

        CopyTitle.setEnabled(false);
        getContentPane().add(CopyTitle);
        CopyTitle.setBounds(20, 80, 250, 25);

        RemoveElem.setIcon(new javax.swing.ImageIcon(getClass().getResource("/drawable/remove.png"))); // NOI18N
        RemoveElem.setBorderPainted(false);
        RemoveElem.setContentAreaFilled(false);
        RemoveElem.addActionListener(new java.awt.event.ActionListener() {
            public void actionPerformed(java.awt.event.ActionEvent evt) {
                RemoveElemActionPerformed(evt);
            }
        });
        getContentPane().add(RemoveElem);
        RemoveElem.setBounds(180, 40, 30, 30);

        pack();
    }// </editor-fold>//GEN-END:initComponents

    private void MoveElemsActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_MoveElemsActionPerformed
        int dx=0;
        int dy=0;
        try {
            dx = Integer.parseInt(DX.getText());
            dy = Integer.parseInt(DY.getText());
            }catch (Exception ee){
                panel.popup("Недопустимый формат целого");
                return;
                }
        if (dx==0 && dy==0){
            panel.popup("Выберите ненудевое перемещение ");
            return;
            }
        final int dxx= dx;
        final int dyy= dy;
        final Meta2GUI view = context.getSelectedView();
        String tt = "Переместить все элементы на dx="+dx+" dy="+dy+" ?";
        new OK(200,200,tt, new I_Button() {
            @Override
            public void onPush() {
                Meta2GUIForm form = context.getForm();
                int num = form.getControls().shift(dxx,dyy);
                panel.main.sendEventPanel(BasePanel.EventRuntimeEdited,0,0,"Сдвинуто "+num+ " элементов ");
                panel.repaintView();                            // Разослать уведомление (форма редактирования)
                dispose();
            }
        });

    }//GEN-LAST:event_MoveElemsActionPerformed

    private void CopyElemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_CopyElemActionPerformed
        final Meta2GUI view = context.getSelectedView();        // Выбранный элемент в контексте рендеринга
        new OK(200,200,"Вставить элемент: "+view.getFullTitle(), new I_Button() {
            @Override
            public void onPush() {
                Meta2GUI copy = null;
                try {
                    copy = view.getClass().newInstance();       // Клонировать элемент
                } catch (Exception ee){
                    dispose();
                    panel.popup("Ошибка создания клона для  "+view.getFullTitle());
                    return;
                }
                copy.cloneGUIData(view);                        // Метод клонирования содержимого для GUI
                Meta2GUIForm form1 = context.getForm();
                Meta2GUIForm form2 = context.getBaseForm();     //
                if (form2!=null)
                    form1 = form2;
                form1.getControls().add(copy);                  // Добавить в список элементов управления GUI формы
                panel.repaintView();                            // Разослать уведомление (форма редактирования)
                panel.main.sendEventPanel(BasePanel.EventRuntimeEdited,0,0,"Добавлен "+form1.getTitle()+": "+copy.getFullTitle());
                dispose();
                }
            });
    }//GEN-LAST:event_CopyElemActionPerformed

    private void formWindowClosed(java.awt.event.WindowEvent evt) {//GEN-FIRST:event_formWindowClosed
        if (back!=null)
            back.onPush();
    }//GEN-LAST:event_formWindowClosed

    private void RemoveElemActionPerformed(java.awt.event.ActionEvent evt) {//GEN-FIRST:event_RemoveElemActionPerformed
        final Meta2GUI view = context.getSelectedView();        // Выбранный элемент в контексте рендеринга
        new OK(200,200,"Удалить элемент: "+view.getFullTitle(), new I_Button() {
            @Override
            public void onPush() {
                Meta2GUIForm form1 = context.getForm();
                Meta2GUIForm form2 = context.getBaseForm();     //
                if (form2!=null)
                    form1 = form2;
                form1.getControls().getList().remove(view);     // Удалить из списка элементов управления GUI формы
                panel.repaintView();                            // Разослать уведомление (форма редактирования)
                panel.main.sendEventPanel(BasePanel.EventRuntimeEdited,0,0,"Удален "+form1.getTitle()+": "+view.getFullTitle());
                dispose();
            }
        });
    }//GEN-LAST:event_RemoveElemActionPerformed

    // Variables declaration - do not modify//GEN-BEGIN:variables
    private javax.swing.JButton CopyElem;
    private javax.swing.JTextField CopyTitle;
    private javax.swing.JTextField DX;
    private javax.swing.JTextField DY;
    private javax.swing.JButton MoveElems;
    private javax.swing.JButton RemoveElem;
    private javax.swing.JLabel jLabel1;
    private javax.swing.JLabel jLabel2;
    // End of variables declaration//GEN-END:variables
}
